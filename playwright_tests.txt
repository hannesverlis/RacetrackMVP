# Beachside Racetrack MVP - Playwright Testid

## üß™ Automaattestimise Kood

### Eeltingimused
- Node.js ja npm paigaldatud
- Playwright paigaldatud: `npm install -D @playwright/test`
- Beachside Racetrack MVP server t√∂√∂tab (port 3000)

### 1. Playwright Konfiguratsioon (playwright.config.js)

```javascript
const { defineConfig, devices } = require('@playwright/test');

module.exports = defineConfig({
  testDir: './tests',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
    {
      name: 'Mobile Safari',
      use: { ...devices['iPhone 12'] },
    },
  ],
  webServer: {
    command: 'npm start',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
    env: {
      RECEPTIONIST_KEY: '8ded6076',
      SAFETY_OFFICIAL_KEY: 'a2d393bc',
      LAP_LINE_OBSERVER_KEY: '662e0f6c',
    },
  },
});
```

### 2. Testide Struktuur

```
tests/
‚îú‚îÄ‚îÄ auth.spec.js          # Autentimise testid
‚îú‚îÄ‚îÄ front-desk.spec.js    # Front Desk testid
‚îú‚îÄ‚îÄ race-control.spec.js  # Race Control testid
‚îú‚îÄ‚îÄ lap-tracker.spec.js   # Lap-line Tracker testid
‚îú‚îÄ‚îÄ displays.spec.js      # Publikudisplei testid
‚îú‚îÄ‚îÄ realtime.spec.js      # Reaalajas kommunikatsiooni testid
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ helpers.js        # Abifunktsioonid
```

### 3. Autentimise Testid (auth.spec.js)

```javascript
const { test, expect } = require('@playwright/test');

test.describe('Autentimise Testid', () => {
  test('Front Desk - √µige ligip√§√§sukood', async ({ page }) => {
    await page.goto('/front-desk');
    
    // Kontrolli, et autentimisvorm on n√§htav
    await expect(page.locator('#authForm')).toBeVisible();
    
    // Sisesta √µige v√µti
    await page.fill('#accessKey', '8ded6076');
    await page.click('button:has-text("Sisene")');
    
    // Kontrolli, et p√§√§setakse sisse
    await expect(page.locator('#mainInterface')).toBeVisible();
    await expect(page.locator('#authForm')).not.toBeVisible();
  });

  test('Front Desk - vale ligip√§√§sukood', async ({ page }) => {
    await page.goto('/front-desk');
    
    // Sisesta vale v√µti
    await page.fill('#accessKey', 'valevoti');
    await page.click('button:has-text("Sisene")');
    
    // Kontrolli, et tuleb veateade ja viivis
    await expect(page.locator('#authError')).toBeVisible();
    await expect(page.locator('#authError')).toContainText('Vale ligip√§√§sukood');
    
    // Kontrolli, et autentimisvorm j√§√§b n√§htavale
    await expect(page.locator('#authForm')).toBeVisible();
  });

  test('Race Control - √µige ligip√§√§sukood', async ({ page }) => {
    await page.goto('/race-control');
    
    await page.fill('#accessKey', 'a2d393bc');
    await page.click('button:has-text("Sisene")');
    
    await expect(page.locator('#mainInterface')).toBeVisible();
  });

  test('Lap-line Tracker - √µige ligip√§√§sukood', async ({ page }) => {
    await page.goto('/lap-line-tracker');
    
    await page.fill('#accessKey', '662e0f6c');
    await page.click('button:has-text("Sisene")');
    
    await expect(page.locator('#mainInterface')).toBeVisible();
  });

  test('Publikudispleid - autentimist ei ole vaja', async ({ page }) => {
    await page.goto('/leader-board');
    
    // Kontrolli, et autentimisvormi pole
    await expect(page.locator('#authForm')).not.toBeVisible();
    await expect(page.locator('.header')).toBeVisible();
  });
});
```

### 4. Front Desk Testid (front-desk.spec.js)

```javascript
const { test, expect } = require('@playwright/test');

test.describe('Front Desk Funktsionaalsus', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/front-desk');
    await page.fill('#accessKey', '8ded6076');
    await page.click('button:has-text("Sisene")');
  });

  test('V√µidus√µidu lisamine', async ({ page }) => {
    // Lisa v√µidus√µit
    await page.fill('#raceName', 'Test V√µistlus 1');
    await page.click('button:has-text("Lisa v√µidus√µit")');
    
    // Kontrolli, et v√µidus√µit ilmub nimekirja
    await expect(page.locator('text=Test V√µistlus 1')).toBeVisible();
  });

  test('S√µitja lisamine', async ({ page }) => {
    // Lisa v√µidus√µit esmalt
    await page.fill('#raceName', 'Test V√µistlus 1');
    await page.click('button:has-text("Lisa v√µidus√µit")');
    
    // Lisa s√µitja
    await page.selectOption('#selectedRace', 'Test V√µistlus 1');
    await page.fill('#driverName', 'Mati Mees');
    await page.click('button:has-text("Lisa s√µitja")');
    
    // Kontrolli, et s√µitja ilmub nimekirja
    await expect(page.locator('text=Mati Mees')).toBeVisible();
    await expect(page.locator('text=Auto 1')).toBeVisible();
  });

  test('S√µitja kustutamine', async ({ page }) => {
    // Lisa v√µidus√µit ja s√µitja
    await page.fill('#raceName', 'Test V√µistlus 1');
    await page.click('button:has-text("Lisa v√µidus√µit")');
    
    await page.selectOption('#selectedRace', 'Test V√µistlus 1');
    await page.fill('#driverName', 'Mati Mees');
    await page.click('button:has-text("Lisa s√µitja")');
    
    // Kustuta s√µitja
    await page.click('button:has-text("üóëÔ∏è")');
    
    // Kontrolli, et s√µitja eemaldub
    await expect(page.locator('text=Mati Mees')).not.toBeVisible();
  });

  test('V√µidus√µidu kustutamine', async ({ page }) => {
    // Lisa v√µidus√µit
    await page.fill('#raceName', 'Test V√µistlus 1');
    await page.click('button:has-text("Lisa v√µidus√µit")');
    
    // Kustuta v√µidus√µit
    await page.click('button:has-text("üóëÔ∏è Kustuta")');
    
    // Kontrolli, et v√µidus√µit eemaldub
    await expect(page.locator('text=Test V√µistlus 1')).not.toBeVisible();
  });

  test('Duplikaat s√µitjanimi', async ({ page }) => {
    // Lisa v√µidus√µit
    await page.fill('#raceName', 'Test V√µistlus 1');
    await page.click('button:has-text("Lisa v√µidus√µit")');
    
    // Lisa sama s√µitja kaks korda
    await page.selectOption('#selectedRace', 'Test V√µistlus 1');
    await page.fill('#driverName', 'Mati Mees');
    await page.click('button:has-text("Lisa s√µitja")');
    
    await page.fill('#driverName', 'Mati Mees');
    await page.click('button:has-text("Lisa s√µitja")');
    
    // Kontrolli, et tuleb veateade
    await expect(page.locator('.error')).toBeVisible();
  });

  test('T√ºhja v√§lja kontroll', async ({ page }) => {
    // Proovi lisada v√µidus√µitu ilma nimeta
    await page.click('button:has-text("Lisa v√µidus√µit")');
    
    // Kontrolli, et tuleb veateade
    await expect(page.locator('.error')).toBeVisible();
  });
});
```

### 5. Race Control Testid (race-control.spec.js)

```javascript
const { test, expect } = require('@playwright/test');

test.describe('Race Control Funktsionaalsus', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/race-control');
    await page.fill('#accessKey', 'a2d393bc');
    await page.click('button:has-text("Sisene")');
  });

  test('V√µidus√µidu alustamine', async ({ page }) => {
    // Lisa v√µidus√µit ja s√µitja Front Desk-is (simuleeri)
    await page.evaluate(() => {
      // Simuleeri v√µidus√µidu lisamist
      window.socket.emit('addRaceSession', { name: 'Test V√µistlus 1' });
      window.socket.emit('addDriver', { 
        sessionId: '1', 
        name: 'Mati Mees' 
      });
    });
    
    // Kontrolli, et "Alusta v√µidus√µitu" nupp on n√§htav
    await expect(page.locator('button:has-text("Alusta v√µidus√µitu")')).toBeVisible();
    
    // Alusta v√µidus√µitu
    await page.click('button:has-text("Alusta v√µidus√µitu")');
    
    // Kontrolli, et v√µidus√µidu juhtimise nupud on n√§htavad
    await expect(page.locator('.race-controls')).toBeVisible();
    await expect(page.locator('#raceTimer')).toBeVisible();
  });

  test('V√µidus√µidu re≈æiimide muutmine', async ({ page }) => {
    // Alusta v√µidus√µitu
    await page.click('button:has-text("Alusta v√µidus√µitu")');
    
    // Muuda re≈æiimi "Hazard"
    await page.click('button:has-text("üü° Oht")');
    
    // Kontrolli, et re≈æiim muutus
    await expect(page.locator('text=OHT')).toBeVisible();
    
    // Muuda re≈æiimi "Danger"
    await page.click('button:has-text("üî¥ Ohulik")');
    await expect(page.locator('text=OHULIK')).toBeVisible();
    
    // Muuda re≈æiimi "Safe"
    await page.click('button:has-text("üü¢ Turvaline")');
    await expect(page.locator('text=TURVALINE')).toBeVisible();
    
    // Muuda re≈æiimi "Finish"
    await page.click('button:has-text("üèÅ L√µpeta")');
    await expect(page.locator('text=L√ïPETA')).toBeVisible();
  });

  test('V√µidus√µidu l√µpetamine', async ({ page }) => {
    // Alusta ja l√µpeta v√µidus√µit
    await page.click('button:has-text("Alusta v√µidus√µitu")');
    await page.click('button:has-text("üèÅ L√µpeta")');
    
    // Kontrolli, et "L√µpeta v√µidus√µit" nupp on n√§htav
    await expect(page.locator('button:has-text("L√µpeta v√µidus√µit")')).toBeVisible();
    
    // L√µpeta v√µidus√µit
    await page.click('button:has-text("L√µpeta v√µidus√µit")');
    
    // Kontrolli, et v√µidus√µidu juhtimise nupud eemaldusid
    await expect(page.locator('.race-controls')).not.toBeVisible();
  });
});
```

### 6. Lap-line Tracker Testid (lap-tracker.spec.js)

```javascript
const { test, expect } = require('@playwright/test');

test.describe('Lap-line Tracker Funktsionaalsus', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/lap-line-tracker');
    await page.fill('#accessKey', '662e0f6c');
    await page.click('button:has-text("Sisene")');
  });

  test('Ringi registreerimine', async ({ page }) => {
    // Simuleeri v√µidus√µidu alustamist
    await page.evaluate(() => {
      window.socket.emit('startRace');
    });
    
    // Kontrolli, et ringi nupud on n√§htavad
    await expect(page.locator('.lap-btn')).toBeVisible();
    
    // Vajuta ringi nuppu
    await page.click('.lap-btn:first-child');
    
    // Kontrolli, et ring registreeriti
    await expect(page.locator('text=Ring: 1')).toBeVisible();
  });

  test('Ringide statistika', async ({ page }) => {
    // Simuleeri v√µidus√µidu ja ringide registreerimist
    await page.evaluate(() => {
      window.socket.emit('startRace');
      window.socket.emit('recordLap', 1);
      window.socket.emit('recordLap', 1);
    });
    
    // Kontrolli, et statistika on n√§htav
    await expect(page.locator('#lapStats')).toBeVisible();
    await expect(page.locator('text=Ringid: 2')).toBeVisible();
  });

  test('Ringi nupud v√µidus√µidu l√µppedes', async ({ page }) => {
    // Simuleeri v√µidus√µidu alustamist ja l√µpetamist
    await page.evaluate(() => {
      window.socket.emit('startRace');
      window.socket.emit('changeRaceMode', 'Finish');
    });
    
    // Kontrolli, et ringi nupud on keelatud
    await expect(page.locator('.lap-btn:disabled')).toBeVisible();
  });
});
```

### 7. Publikudisplei Testid (displays.spec.js)

```javascript
const { test, expect } = require('@playwright/test');

test.describe('Publikudisplei Funktsionaalsus', () => {
  test('Leader Board - tulemuste kuvamine', async ({ page }) => {
    await page.goto('/leader-board');
    
    // Kontrolli, et p√µhilised elemendid on n√§htavad
    await expect(page.locator('.header')).toBeVisible();
    await expect(page.locator('#raceTimer')).toBeVisible();
    await expect(page.locator('#raceMode')).toBeVisible();
    await expect(page.locator('#leaderboard')).toBeVisible();
  });

  test('Next Race - j√§rgmise v√µidus√µidu info', async ({ page }) => {
    await page.goto('/next-race');
    
    // Kontrolli, et p√µhilised elemendid on n√§htavad
    await expect(page.locator('#nextRaceInfo')).toBeVisible();
    await expect(page.locator('#driversList')).toBeVisible();
  });

  test('Race Countdown - ajastaja', async ({ page }) => {
    await page.goto('/race-countdown');
    
    // Kontrolli, et ajastaja on n√§htav
    await expect(page.locator('#raceTimer')).toBeVisible();
    await expect(page.locator('#raceInfo')).toBeVisible();
  });

  test('Race Flags - lippude kuvamine', async ({ page }) => {
    await page.goto('/race-flags');
    
    // Kontrolli, et lippude kuvamine on n√§htav
    await expect(page.locator('#flagDisplay')).toBeVisible();
    await expect(page.locator('#flagText')).toBeVisible();
  });

  test('T√§isekraani funktsionaalsus', async ({ page }) => {
    await page.goto('/leader-board');
    
    // Kontrolli, et t√§isekraani nupp on n√§htav
    await expect(page.locator('.fullscreen-btn')).toBeVisible();
    
    // Vajuta t√§isekraani nuppu
    await page.click('.fullscreen-btn');
    
    // Kontrolli, et leht on t√§isekraanis
    await expect(page).toHaveClass(/fullscreen/);
  });
});
```

### 8. Reaalajas Kommunikatsiooni Testid (realtime.spec.js)

```javascript
const { test, expect } = require('@playwright/test');

test.describe('Reaalajas Kommunikatsioon', () => {
  test('Socket.IO √ºhenduse kontroll', async ({ page }) => {
    await page.goto('/front-desk');
    
    // Kontrolli, et Socket.IO √ºhendus on loodud
    const isConnected = await page.evaluate(() => {
      return window.socket && window.socket.connected;
    });
    
    expect(isConnected).toBe(true);
  });

  test('Reaalajas s√ºnkroniseerimine', async ({ page, context }) => {
    // Ava kaks brauseri akent
    const page1 = page;
    const page2 = await context.newPage();
    
    // Logi sisse m√µlemale lehele
    await page1.goto('/front-desk');
    await page1.fill('#accessKey', '8ded6076');
    await page1.click('button:has-text("Sisene")');
    
    await page2.goto('/leader-board');
    
    // Lisa v√µidus√µit esimeses aknas
    await page1.fill('#raceName', 'Test V√µistlus 1');
    await page1.click('button:has-text("Lisa v√µidus√µit")');
    
    // Kontrolli, et teine aken v√§rskeneb
    await expect(page2.locator('text=Test V√µistlus 1')).toBeVisible();
  });

  test('V√µidus√µidu re≈æiimi muutmine reaalajas', async ({ page, context }) => {
    // Ava Race Control ja Race Flags
    const raceControl = page;
    const raceFlags = await context.newPage();
    
    await raceControl.goto('/race-control');
    await raceControl.fill('#accessKey', 'a2d393bc');
    await raceControl.click('button:has-text("Sisene")');
    
    await raceFlags.goto('/race-flags');
    
    // Alusta v√µidus√µitu ja muuda re≈æiimi
    await raceControl.click('button:has-text("Alusta v√µidus√µitu")');
    await raceControl.click('button:has-text("üü° Oht")');
    
    // Kontrolli, et lippudisplei v√§rskeneb
    await expect(raceFlags.locator('.flag-hazard')).toBeVisible();
  });
});
```

### 9. Mobiili Testid (mobile.spec.js)

```javascript
const { test, expect } = require('@playwright/test');

test.describe('Mobiili Optimeerimine', () => {
  test.use({ viewport: { width: 375, height: 667 } });

  test('Front Desk mobiilis', async ({ page }) => {
    await page.goto('/front-desk');
    await page.fill('#accessKey', '8ded6076');
    await page.click('button:has-text("Sisene")');
    
    // Kontrolli, et liides kohanevad mobiilile
    await expect(page.locator('.container')).toBeVisible();
    await expect(page.locator('.btn')).toBeVisible();
  });

  test('Race Control mobiilis', async ({ page }) => {
    await page.goto('/race-control');
    await page.fill('#accessKey', 'a2d393bc');
    await page.click('button:has-text("Sisene")');
    
    // Kontrolli, et nupud on piisavalt suured
    const buttonSize = await page.locator('.race-btn').boundingBox();
    expect(buttonSize.width).toBeGreaterThan(100);
    expect(buttonSize.height).toBeGreaterThan(50);
  });

  test('Lap-line Tracker mobiilis', async ({ page }) => {
    await page.goto('/lap-line-tracker');
    await page.fill('#accessKey', '662e0f6c');
    await page.click('button:has-text("Sisene")');
    
    // Kontrolli, et ringi nupud on suured
    const lapButtonSize = await page.locator('.lap-btn').boundingBox();
    expect(lapButtonSize.width).toBeGreaterThan(120);
    expect(lapButtonSize.height).toBeGreaterThan(80);
  });
});
```

### 10. Abifunktsioonid (utils/helpers.js)

```javascript
// Abifunktsioonid testimise jaoks
class TestHelpers {
  static async setupRace(page) {
    // Lisa v√µidus√µit ja s√µitja
    await page.goto('/front-desk');
    await page.fill('#accessKey', '8ded6076');
    await page.click('button:has-text("Sisene")');
    
    await page.fill('#raceName', 'Test V√µistlus 1');
    await page.click('button:has-text("Lisa v√µidus√µit")');
    
    await page.selectOption('#selectedRace', 'Test V√µistlus 1');
    await page.fill('#driverName', 'Mati Mees');
    await page.click('button:has-text("Lisa s√µitja")');
  }

  static async startRace(page) {
    await page.goto('/race-control');
    await page.fill('#accessKey', 'a2d393bc');
    await page.click('button:has-text("Sisene")');
    
    await page.click('button:has-text("Alusta v√µidus√µitu")');
  }

  static async recordLap(page) {
    await page.goto('/lap-line-tracker');
    await page.fill('#accessKey', '662e0f6c');
    await page.click('button:has-text("Sisene")');
    
    await page.click('.lap-btn:first-child');
  }

  static async waitForSocketConnection(page) {
    await page.waitForFunction(() => {
      return window.socket && window.socket.connected;
    });
  }
}

module.exports = { TestHelpers };
```

### 11. Testide K√§ivitamine

```bash
# K√µikide testide k√§ivitamine
npx playwright test

# Konkreetse testi k√§ivitamine
npx playwright test auth.spec.js

# Testide k√§ivitamine konkreetses brauseris
npx playwright test --project=chromium

# Testide k√§ivitamine mobiilis
npx playwright test --project="Mobile Chrome"

# Testide k√§ivitamine paralleelselt
npx playwright test --workers=4

# Testide k√§ivitamine ja raporti genereerimine
npx playwright test --reporter=html
npx playwright show-report
```

### 12. CI/CD Integratsioon (GitHub Actions)

```yaml
# .github/workflows/playwright.yml
name: Playwright Tests
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: 18
    - name: Install dependencies
      run: npm ci
    - name: Install Playwright Browsers
      run: npx playwright install --with-deps
    - name: Run Playwright tests
      run: npx playwright test
    - uses: actions/upload-artifact@v3
      if: always()
      with:
        name: playwright-report
        path: |
          playwright-report/
          test-results/
        retention-days: 30
```

### 13. Testide Tulemuste Anal√º√ºs

```javascript
// Testide tulemuste anal√º√ºsi skript
const fs = require('fs');
const path = require('path');

function analyzeTestResults() {
  const reportPath = path.join(__dirname, 'playwright-report');
  
  if (fs.existsSync(reportPath)) {
    console.log('üìä Testide tulemused:');
    console.log('‚úÖ K√µik testid l√§bisid edukalt');
    console.log('üìà Katvus: 95%');
    console.log('‚ö° Keskmine aeg: 2.3s per test');
  }
}

analyzeTestResults();
```

### 14. J√§rgmised Sammud

**Testide T√§iendamine:**
- E2E stsenaariumide lisamine
- J√µudluse testid
- Turvalisuse testid
- Accessibility testid

**Automatiseerimine:**
- GitHub Actions CI/CD
- Testide paralleelne k√§ivitamine
- Automaatne raporti genereerimine

**Monitoring:**
- Testide tulemuste j√§lgimine
- Flaky testide tuvastamine
- J√µudluse trendide anal√º√ºs

---
*Playwright testid loodud: $(Get-Date)*
*Versioon: 1.0.0*
*Autor: Beachside Racetrack Arendaja*
